import{m as p,V as Le,A as P,an as se,v as $,B as M,al as G,J as j,d as k,ao as Ue,y as w,D as Se,N as W,ap as je,aq as xe,h as r,Y as we,T as me,H as ke,P as q,q as H,s as ce,n as Ye,ar as ze,M as L,as as Z,at as De,W as ie,E as _e,au as Ke,l as Q,O as qe,C as ee,K as Ge,F as Je,av as We,b as Oe,aw as Qe,R as te,S as ne,a4 as Xe,L as re,_ as Ze,u as et,ad as tt,x as nt,e as fe,f as at,o as lt,c as ot}from"./index-d69430ba.js";import{C as Be}from"./index-b0130fdc.js";import{F as J}from"./index-f20a8a39.js";import{T as st,a as ct}from"./index-b90f6f1b.js";import{_ as Ee}from"./Header-53ed58ce.js";import{b as it}from"./api-cb560b03.js";import{F as rt}from"./index-7fd5cfb8.js";import{B as ve}from"./index-7885404b.js";import"./use-route-d5cecb2c.js";import"./use-id-6c976a03.js";const[ut,V,he]=p("picker"),Ve=e=>e.find(t=>!t.disabled)||e[0];function dt(e,t){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(t.children in n)return"cascade"}return"default"}function ue(e,t){t=se(t,0,e.length);for(let n=t;n<e.length;n++)if(!e[n].disabled)return n;for(let n=t-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const ge=(e,t,n)=>t!==void 0&&!!e.find(s=>s[n.value]===t);function de(e,t,n){const s=e.findIndex(f=>f[n.value]===t),l=ue(e,s);return e[l]}function mt(e,t,n){const s=[];let l={[t.children]:e},f=0;for(;l&&l[t.children];){const i=l[t.children],v=n.value[f];if(l=Le(v)?de(i,v,t):void 0,!l&&i.length){const h=Ve(i)[t.value];l=de(i,h,t)}f++,s.push(i)}return s}function ft(e){const{transform:t}=window.getComputedStyle(e),n=t.slice(7,t.length-1).split(", ")[5];return Number(n)}function vt(e){return P({text:"text",value:"value",children:"children"},e)}const be=200,ye=300,ht=15,[Pe,ae]=p("picker-column"),pe=Symbol(Pe);var gt=$({name:Pe,props:{value:M,fields:G(Object),options:j(),readonly:Boolean,allowHtml:Boolean,optionHeight:G(Number),swipeDuration:G(M),visibleOptionNum:G(M)},emits:["change","clickOption","scrollInto"],setup(e,{emit:t,slots:n}){let s,l,f,i,v;const h=k(),a=k(),u=k(0),y=k(0),g=Ue(),T=()=>e.options.length,E=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,D=b=>{const o=ue(e.options,b),c=-o*e.optionHeight,m=()=>{const A=e.options[o][e.fields.value];A!==e.value&&t("change",A)};s&&c!==u.value?v=m:m(),u.value=c},O=()=>e.readonly||!e.options.length,Y=b=>{s||O()||(v=null,y.value=be,D(b),t("clickOption",e.options[b]))},I=b=>se(Math.round(-b/e.optionHeight),0,T()-1),N=w(()=>I(u.value)),z=(b,o)=>{const c=Math.abs(b/o);b=u.value+c/.003*(b<0?-1:1);const m=I(b);y.value=+e.swipeDuration,D(m)},d=()=>{s=!1,y.value=0,v&&(v(),v=null)},S=b=>{if(!O()){if(g.start(b),s){const o=ft(a.value);u.value=Math.min(0,o-E())}y.value=0,l=u.value,f=Date.now(),i=l,v=null}},C=b=>{if(O())return;g.move(b),g.isVertical()&&(s=!0,we(b,!0));const o=se(l+g.deltaY.value,-(T()*e.optionHeight),e.optionHeight),c=I(o);c!==N.value&&t("scrollInto",e.options[c]),u.value=o;const m=Date.now();m-f>ye&&(f=m,i=o)},_=()=>{if(O())return;const b=u.value-i,o=Date.now()-f;if(o<ye&&Math.abs(b)>ht){z(b,o);return}const m=I(u.value);y.value=be,D(m),setTimeout(()=>{s=!1},0)},B=()=>{const b={height:`${e.optionHeight}px`};return e.options.map((o,c)=>{const m=o[e.fields.text],{disabled:A}=o,K=o[e.fields.value],Fe={role:"button",style:b,tabindex:A?-1:0,class:[ae("item",{disabled:A,selected:K===e.value}),o.className],onClick:()=>Y(c)},He={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:m};return r("li",Fe,[n.option?n.option(o,c):r("div",He,null)])})};return Se(pe),W({stopMomentum:d}),je(()=>{const b=e.options.findIndex(m=>m[e.fields.value]===e.value),c=-ue(e.options,b)*e.optionHeight;u.value=c}),xe("touchmove",C,{target:h}),()=>r("div",{ref:h,class:ae(),onTouchstartPassive:S,onTouchend:_,onTouchcancel:_},[r("ul",{ref:a,style:{transform:`translate3d(0, ${u.value+E()}px, 0)`,transitionDuration:`${y.value}ms`,transitionProperty:y.value?"all":"none"},class:ae("wrapper"),onTransitionend:d},[B()])])}});const[bt]=p("picker-toolbar"),X={title:String,cancelButtonText:String,confirmButtonText:String},Ie=["cancel","confirm","title","toolbar"],yt=Object.keys(X);var Ae=$({name:bt,props:X,emits:["confirm","cancel"],setup(e,{emit:t,slots:n}){const s=()=>{if(n.title)return n.title();if(e.title)return r("div",{class:[V("title"),"van-ellipsis"]},[e.title])},l=()=>t("cancel"),f=()=>t("confirm"),i=()=>{const h=e.cancelButtonText||he("cancel");return r("button",{type:"button",class:[V("cancel"),me],onClick:l},[n.cancel?n.cancel():h])},v=()=>{const h=e.confirmButtonText||he("confirm");return r("button",{type:"button",class:[V("confirm"),me],onClick:f},[n.confirm?n.confirm():h])};return()=>r("div",{class:V("toolbar")},[n.toolbar?n.toolbar():[i(),s(),v()]])}});const[Re,le]=p("picker-group"),$e=Symbol(Re),Ct=P({tabs:j(),nextStepText:String},X);$({name:Re,props:Ct,emits:["confirm","cancel"],setup(e,{emit:t,slots:n}){const s=k(0),{children:l,linkChildren:f}=ke($e);f();const i=()=>s.value<e.tabs.length-1&&e.nextStepText,v=()=>{i()?s.value++:t("confirm",l.map(a=>a.confirm()))},h=()=>t("cancel");return()=>{var a;const u=(a=n.default)==null?void 0:a.call(n),y=i()?e.nextStepText:e.confirmButtonText;return r("div",{class:le()},[r(Ae,{title:e.title,cancelButtonText:e.cancelButtonText,confirmButtonText:y,onConfirm:v,onCancel:h},q(n,Ie)),r(st,{active:s.value,"onUpdate:active":g=>s.value=g,class:le("tabs"),shrink:!0,animated:!0,lazyRender:!1},{default:()=>[e.tabs.map((g,T)=>r(ct,{title:g,titleClass:le("tab-title")},{default:()=>[u==null?void 0:u[T]]}))]})])}}});const Me=P({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:H(44),showToolbar:ce,swipeDuration:H(1e3),visibleOptionNum:H(6)},X),Tt=P({},Me,{columns:j(),modelValue:j(),toolbarPosition:Ye("top"),columnsFieldNames:Object});var St=$({name:ut,props:Tt,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:t,slots:n}){const s=k(),l=k(e.modelValue.slice(0)),{parent:f}=Se($e),{children:i,linkChildren:v}=ke(pe);v();const h=w(()=>vt(e.columnsFieldNames)),a=w(()=>ze(e.optionHeight)),u=w(()=>dt(e.columns,h.value)),y=w(()=>{const{columns:o}=e;switch(u.value){case"multiple":return o;case"cascade":return mt(o,h.value,l);default:return[o]}}),g=w(()=>y.value.some(o=>o.length)),T=w(()=>y.value.map((o,c)=>de(o,l.value[c],h.value))),E=w(()=>y.value.map((o,c)=>o.findIndex(m=>m[h.value.value]===l.value[c]))),D=(o,c)=>{if(l.value[o]!==c){const m=l.value.slice(0);m[o]=c,l.value=m}},O=()=>({selectedValues:l.value.slice(0),selectedOptions:T.value,selectedIndexes:E.value}),Y=(o,c)=>{D(c,o),u.value==="cascade"&&l.value.forEach((m,A)=>{const K=y.value[A];ge(K,m,h.value)||D(A,K.length?K[0][h.value.value]:void 0)}),ie(()=>{t("change",P({columnIndex:c},O()))})},I=(o,c)=>{const m={columnIndex:c,currentOption:o};t("clickOption",P(O(),m)),t("scrollInto",m)},N=()=>{i.forEach(c=>c.stopMomentum());const o=O();return ie(()=>{t("confirm",o)}),o},z=()=>t("cancel",O()),d=()=>y.value.map((o,c)=>r(gt,{value:l.value[c],fields:h.value,options:o,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:a.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:m=>Y(m,c),onClickOption:m=>I(m,c),onScrollInto:m=>{t("scrollInto",{currentOption:m,columnIndex:c})}},{option:n.option})),S=o=>{if(g.value){const c={height:`${a.value}px`},m={backgroundSize:`100% ${(o-a.value)/2}px`};return[r("div",{class:V("mask"),style:m},null),r("div",{class:[Ke,V("frame")],style:c},null)]}},C=()=>{const o=a.value*+e.visibleOptionNum,c={height:`${o}px`};return r("div",{ref:s,class:V("columns"),style:c},[d(),S(o)])},_=()=>{if(e.showToolbar&&!f)return r(Ae,_e(q(e,yt),{onConfirm:N,onCancel:z}),q(n,Ie))};L(y,o=>{o.forEach((c,m)=>{c.length&&!ge(c,l.value[m],h.value)&&D(m,Ve(c)[h.value.value])})},{immediate:!0});let B;return L(()=>e.modelValue,o=>{!Z(o,l.value)&&!Z(o,B)&&(l.value=o.slice(0),B=o.slice(0))},{deep:!0}),L(l,o=>{Z(o,e.modelValue)||(B=o.slice(0),t("update:modelValue",B))},{immediate:!0}),xe("touchmove",we,{target:s}),W({confirm:N,getSelectedOptions:()=>T.value}),()=>{var o,c;return r("div",{class:V()},[e.toolbarPosition==="top"?_():null,e.loading?r(De,{class:V("loading")},null):null,(o=n["columns-top"])==null?void 0:o.call(n),C(),(c=n["columns-bottom"])==null?void 0:c.call(n),e.toolbarPosition==="bottom"?_():null])}}});const U="000000",xt=["title","cancel","confirm","toolbar","columns-top","columns-bottom"],wt=["title","loading","readonly","optionHeight","swipeDuration","visibleOptionNum","cancelButtonText","confirmButtonText"],R=(e="",t=U,n=void 0)=>({text:e,value:t,children:n});function kt({areaList:e,columnsNum:t,columnsPlaceholder:n}){const{city_list:s={},county_list:l={},province_list:f={}}=e,i=+t>1,v=+t>2,h=()=>{if(i)return n.length?[R(n[0],U,v?[]:void 0)]:[]},a=new Map;Object.keys(f).forEach(g=>{a.set(g.slice(0,2),R(f[g],g,h()))});const u=new Map;if(i){const g=()=>{if(v)return n.length?[R(n[1])]:[]};Object.keys(s).forEach(T=>{const E=R(s[T],T,g());u.set(T.slice(0,4),E);const D=a.get(T.slice(0,2));D&&D.children.push(E)})}v&&Object.keys(l).forEach(g=>{const T=u.get(g.slice(0,4));T&&T.children.push(R(l[g],g))});const y=Array.from(a.values());if(n.length){const g=v?[R(n[2])]:void 0,T=i?[R(n[1],U,g)]:void 0;y.unshift(R(n[0],U,T))}return y}const Dt=Q(St),[_t,Ot]=p("area"),Bt=P({},Me,{modelValue:String,columnsNum:H(3),columnsPlaceholder:j(),areaList:{type:Object,default:()=>({})}});var Et=$({name:_t,props:Bt,emits:["change","confirm","cancel","update:modelValue"],setup(e,{emit:t,slots:n}){const s=k([]),l=k(),f=w(()=>kt(e)),i=(...a)=>t("change",...a),v=(...a)=>t("cancel",...a),h=(...a)=>t("confirm",...a);return L(s,a=>{const u=a.length?a[a.length-1]:"";u&&u!==e.modelValue&&t("update:modelValue",u)},{deep:!0}),L(()=>e.modelValue,a=>{if(a){const u=s.value.length?s.value[s.value.length-1]:"";a!==u&&(s.value=[`${a.slice(0,2)}0000`,`${a.slice(0,4)}00`,a].slice(0,+e.columnsNum))}else s.value=[]},{immediate:!0}),W({confirm:()=>{var a;return(a=l.value)==null?void 0:a.confirm()},getSelectedOptions:()=>{var a;return((a=l.value)==null?void 0:a.getSelectedOptions())||[]}}),()=>r(Dt,_e({ref:l,modelValue:s.value,"onUpdate:modelValue":a=>s.value=a,class:Ot(),columns:f.value,onChange:i,onCancel:v,onConfirm:h},q(e,wt)),q(n,xt))}});const Vt=Q(Et),[Pt,oe]=p("switch"),pt={size:M,loading:Boolean,disabled:Boolean,modelValue:ee,activeColor:String,inactiveColor:String,activeValue:{type:ee,default:!0},inactiveValue:{type:ee,default:!1}};var It=$({name:Pt,props:pt,emits:["change","update:modelValue"],setup(e,{emit:t,slots:n}){const s=()=>e.modelValue===e.activeValue,l=()=>{if(!e.disabled&&!e.loading){const i=s()?e.inactiveValue:e.activeValue;t("update:modelValue",i),t("change",i)}},f=()=>{if(e.loading){const i=s()?e.activeColor:e.inactiveColor;return r(De,{class:oe("loading"),color:i},null)}if(n.node)return n.node()};return qe(()=>e.modelValue),()=>{var i;const{size:v,loading:h,disabled:a,activeColor:u,inactiveColor:y}=e,g=s(),T={fontSize:Ge(v),backgroundColor:g?u:y};return r("div",{role:"switch",class:oe({on:g,loading:h,disabled:a}),style:T,tabindex:a?void 0:0,"aria-checked":g,onClick:l},[r("div",{class:oe("node")},[f()]),(i=n.background)==null?void 0:i.call(n)])}}});const At=Q(It),[Rt,Ce]=p("address-edit-detail"),Te=p("address-edit")[2];var $t=$({name:Rt,props:{show:Boolean,rows:M,value:String,rules:Array,focused:Boolean,maxlength:M,searchResult:Array,showSearchResult:Boolean},emits:["blur","focus","input","selectSearch"],setup(e,{emit:t}){const n=k(),s=()=>e.focused&&e.searchResult&&e.showSearchResult,l=a=>{t("selectSearch",a),t("input",`${a.address||""} ${a.name||""}`.trim())},f=()=>{if(!s())return;const{searchResult:a}=e;return a.map(u=>r(Be,{clickable:!0,key:(u.name||"")+(u.address||""),icon:"location-o",title:u.name,label:u.address,class:Ce("search-item"),border:!1,onClick:()=>l(u)},null))},i=a=>t("blur",a),v=a=>t("focus",a),h=a=>t("input",a);return()=>{if(e.show)return r(Je,null,[r(J,{autosize:!0,clearable:!0,ref:n,class:Ce(),rows:e.rows,type:"textarea",rules:e.rules,label:Te("addressDetail"),border:!s(),maxlength:e.maxlength,modelValue:e.value,placeholder:Te("addressDetail"),onBlur:i,onFocus:v,"onUpdate:modelValue":h},null),f()])}}});const[Mt,F,x]=p("address-edit"),Ne={name:"",tel:"",city:"",county:"",country:"",province:"",areaCode:"",isDefault:!1,addressDetail:""},Nt={areaList:Object,isSaving:Boolean,isDeleting:Boolean,validator:Function,showArea:ce,showDetail:ce,showDelete:Boolean,disableArea:Boolean,searchResult:Array,telMaxlength:M,showSetDefault:Boolean,saveButtonText:String,areaPlaceholder:String,deleteButtonText:String,showSearchResult:Boolean,detailRows:H(1),detailMaxlength:H(200),areaColumnsPlaceholder:j(),addressInfo:{type:Object,default:()=>P({},Ne)},telValidator:{type:Function,default:We}};var Ft=$({name:Mt,props:Nt,emits:["save","focus","delete","clickArea","changeArea","changeDetail","selectSearch","changeDefault"],setup(e,{emit:t,slots:n}){const s=k(),l=Oe({}),f=k(!1),i=k(!1),v=w(()=>Qe(e.areaList)&&Object.keys(e.areaList).length),h=w(()=>{const{province:d,city:S,county:C,areaCode:_}=l;if(_){const B=[d,S,C];return d&&d===S&&B.splice(1,1),B.filter(Boolean).join("/")}return""}),a=w(()=>{var d;return((d=e.searchResult)==null?void 0:d.length)&&i.value}),u=d=>{i.value=d==="addressDetail",t("focus",d)},y=w(()=>{const{validator:d,telValidator:S}=e,C=(_,B)=>({validator:b=>{if(d){const o=d(_,b);if(o)return o}return b?!0:B}});return{name:[C("name",x("nameEmpty"))],tel:[C("tel",x("telInvalid")),{validator:S,message:x("telInvalid")}],areaCode:[C("areaCode",x("areaEmpty"))],addressDetail:[C("addressDetail",x("addressEmpty"))]}}),g=()=>t("save",l),T=d=>{l.addressDetail=d,t("changeDetail",d)},E=d=>{l.province=d[0].text,l.city=d[1].text,l.county=d[2].text},D=({selectedValues:d,selectedOptions:S})=>{d.some(C=>C===U)?re(x("areaEmpty")):(f.value=!1,E(S),t("changeArea",S))},O=()=>t("delete",l),Y=d=>{l.areaCode=d||""},I=()=>{setTimeout(()=>{i.value=!1})},N=d=>{l.addressDetail=d},z=()=>{if(e.showSetDefault){const d={"right-icon":()=>r(At,{modelValue:l.isDefault,"onUpdate:modelValue":S=>l.isDefault=S,onChange:S=>t("changeDefault",S)},null)};return te(r(Be,{center:!0,title:x("defaultAddress"),class:F("default")},d),[[ne,!a.value]])}};return W({setAreaCode:Y,setAddressDetail:N}),L(()=>e.addressInfo,d=>{P(l,Ne,d),ie(()=>{var S;const C=(S=s.value)==null?void 0:S.getSelectedOptions();C&&C.every(_=>_&&_.value!==U)&&E(C)})},{deep:!0,immediate:!0}),()=>{const{disableArea:d}=e;return r(rt,{class:F(),onSubmit:g},{default:()=>{var S;return[r("div",{class:F("fields")},[r(J,{modelValue:l.name,"onUpdate:modelValue":C=>l.name=C,clearable:!0,label:x("name"),rules:y.value.name,placeholder:x("name"),onFocus:()=>u("name")},null),r(J,{modelValue:l.tel,"onUpdate:modelValue":C=>l.tel=C,clearable:!0,type:"tel",label:x("tel"),rules:y.value.tel,maxlength:e.telMaxlength,placeholder:x("tel"),onFocus:()=>u("tel")},null),te(r(J,{readonly:!0,label:x("area"),"is-link":!d,modelValue:h.value,rules:y.value.areaCode,placeholder:e.areaPlaceholder||x("area"),onFocus:()=>u("areaCode"),onClick:()=>{t("clickArea"),f.value=!d}},null),[[ne,e.showArea]]),r($t,{show:e.showDetail,rows:e.detailRows,rules:y.value.addressDetail,value:l.addressDetail,focused:i.value,maxlength:e.detailMaxlength,searchResult:e.searchResult,showSearchResult:e.showSearchResult,onBlur:I,onFocus:()=>u("addressDetail"),onInput:T,onSelectSearch:C=>t("selectSearch",C)},null),(S=n.default)==null?void 0:S.call(n)]),z(),te(r("div",{class:F("buttons")},[r(ve,{block:!0,round:!0,type:"primary",text:e.saveButtonText||x("save"),class:F("button"),loading:e.isSaving,nativeType:"submit"},null),e.showDelete&&r(ve,{block:!0,round:!0,class:F("button"),loading:e.isDeleting,text:e.deleteButtonText||x("delete"),onClick:O},null)]),[[ne,!a.value]]),r(Xe,{show:f.value,"onUpdate:show":C=>f.value=C,round:!0,teleport:"body",position:"bottom",lazyRender:!1},{default:()=>[r(Vt,{modelValue:l.areaCode,"onUpdate:modelValue":C=>l.areaCode=C,ref:s,loading:!v.value,areaList:e.areaList,columnsPlaceholder:e.areaColumnsPlaceholder,onConfirm:D,onCancel:()=>{f.value=!1}},null)]})]}})}}});const Ht=Q(Ft);const Lt={components:{Header:Ee},setup(){const e=et(),t=tt(),n=nt(),s=Oe({areaList:{},addressInfo:{}}),l=()=>{it().then(a=>{s.areaList=a})};fe(()=>{l()});const f=a=>{t.query.type==="add"?n.commit("addaddress",a):n.commit("editaddress",a),re("保存成功"),setTimeout(()=>{e.back()},1e3)},i=a=>{n.commit("deleteaddress",a),re("删除成功"),setTimeout(()=>{e.back()},1e3)},v=()=>{n.state.userAddress.forEach(a=>{a.id===Number(t.query.id)&&(s.addressInfo=a)})};fe(()=>{v()});const h=w(()=>t.query.type==="add"?"地址新增":"地址编辑");return{...at(s),onSave:f,onDelete:i,address:h}}};function Ut(e,t,n,s,l,f){const i=Ee,v=Ht;return lt(),ot("div",null,[r(i,{title:s.address},null,8,["title"]),r(v,{"area-list":e.areaList,"address-info":e.addressInfo,"show-delete":"","show-set-default":"","show-search-result":"","area-columns-placeholder":["请选择","请选择","请选择"],onSave:s.onSave,onDelete:s.onDelete},null,8,["area-list","address-info","onSave","onDelete"])])}const Zt=Ze(Lt,[["render",Ut],["__scopeId","data-v-856414f6"]]);export{Zt as default};
